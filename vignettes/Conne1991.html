<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Carl James Schwarz" />

<meta name="date" content="2019-01-03" />

<title>Conne River 1991 Data</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Conne River 1991 Data</h1>
<h4 class="author"><em>Carl James Schwarz</em></h4>
<h4 class="date"><em>2019-01-03</em></h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This analyzes a dataset from the Conne River, Newfoundland collected in 1991. Smolts are tagged and released at one location in the river. A fence at a second station also captures fish. Data are stratified on a weekly level.</p>
<p>The Conne River 1992 vignette has larger sample sizes.</p>
<p>A stratified-Petersen estimator (Darrock, 1961; Plante et al. 1996) is found for the original data and some pooling of the rows/columns.</p>
</div>
<div id="load-the-spas-package" class="section level2">
<h2>Load the SPAS package</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(SPAS)</code></pre></div>
<p>This will load the SPAS fitting functions and any associated packages needed by SPAS.</p>
</div>
<div id="import-the-data." class="section level2">
<h2>Import the data.</h2>
<p>The data should be stored as an <span class="math inline">\(s+1\)</span> by <span class="math inline">\(t+1\)</span> (before pooling) matrix where the upper <span class="math inline">\(s \times t\)</span> matrix consists of the The <span class="math inline">\(s \times t\)</span> upper left matrix is the number of animals released in row stratum <span class="math inline">\(i\)</span> and recovered in column stratum <span class="math inline">\(j\)</span>. Row <span class="math inline">\(s+1\)</span> contains the total number of UNMARKED animals recovered in column stratum <span class="math inline">\(j\)</span>. Column <span class="math inline">\(t+1\)</span> contains the number of animals marked in each row stratum but not recovered in any column stratum. The <span class="math inline">\(rawdata[s+1, t+1]\)</span> is not used and can be set to 0 or NA. The sum of the entries in each of the first <span class="math inline">\(s\)</span> rows is then the number of animals marked in each row stratum. The sum of the entries in each of the first <span class="math inline">\(t\)</span> columns is then the number of animals captured (marked and unmarked) in each column stratum. The row/column names of the matrix may be set to identify the entries in the output.</p>
<p>Here is the raw data for the Conne River. Notice that very small number of releases and recoveries in week 6.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">conne.data.csv &lt;-<span class="st"> </span><span class="kw">textConnection</span>(<span class="st">&quot;</span>
<span class="st">9  ,    21  ,     0  ,    0  ,    0  ,    0  ,   171</span>
<span class="st">0  ,   101  ,    22  ,    1  ,    0  ,    0  ,   763</span>
<span class="st">0  ,     0  ,   128  ,   49  ,    0  ,    0  ,   934</span>
<span class="st">0  ,     0  ,     0  ,   48  ,   12  ,    0  ,   434</span>
<span class="st">0  ,     0  ,     0  ,    0  ,    7  ,    0  ,    49</span>
<span class="st">0  ,     0  ,     0  ,    0  ,    0  ,    0  ,     4</span>
<span class="st">351,  2736  ,  3847  , 1818  ,  543  ,   191 ,     0&quot;</span>)
conne.data &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">read.csv</span>(conne.data.csv, <span class="dt">header=</span><span class="ot">FALSE</span>))</code></pre></div>
<p>A total of 201 fish were tagged and released in week 1. Of these fish, 9 were recovered downnstream in column stratum 1; 21 were recovered in column stratum 2; and 171 were never seen again. A total of 351 UNMARKED fish were recovered in column stratum 1.</p>
<p>You can add row and column names to the matrix which will used when the data are printed.</p>
</div>
<div id="fitting-the-stratified-petersen-model" class="section level2">
<h2>Fitting the Stratified-Petersen model</h2>
<p>The Stratified-Petersen model is fit to the above data object using:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod1 &lt;-<span class="st"> </span>SPAS<span class="op">::</span><span class="kw">SPAS.fit.model</span>(conne.data,
                       <span class="dt">model.id=</span><span class="st">&quot;No restrictions&quot;</span>,
                       <span class="dt">row.pool.in=</span><span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">col.pool.in=</span><span class="dv">1</span><span class="op">:</span><span class="dv">6</span>)
<span class="co">#&gt; Warning in sqrt(diag(hess$vcv)): NaNs produced</span>
<span class="co">#&gt; Warning in sqrt(diag(RESULT$est.star$vcv)): NaNs produced</span>
<span class="co">#&gt; Warning in sqrt(diag(RESULT$real$vcv)): NaNs produced</span>
<span class="co">#&gt; Warning in sqrt(RESULT$real$est.indiv$N.stratum.vcv): NaNs produced</span>
<span class="co">#&gt; Warning in sqrt(diag(RESULT$real$est.indiv$exp.factor.vcv)): NaNs produced</span></code></pre></div>
<p>The <code>row.pool.in</code> and <code>col.pool.in</code> inform the function on which rows or columns to pool before the analysis proceeds. Both parameters use a vector of codes (length <span class="math inline">\(s\)</span> for row pooing and length <span class="math inline">\(t\)</span> for column pooling) where rows/columns are pooled that share the same value.</p>
<p>For example. <code>row.pool.in=c(1,2,3,4,5,6)</code> would imply that no rows are pooled, while <code>row.pool.in=c('a','a','a','b','b','b')</code> would imply that the first three rows and last three rows are pooled. The entries in the vector can be numeric or character; however, using character entries implies that the final pooled matrix is displayed in the order of the character entries. I find that using entries such as <code>'123'</code> to represent pooling rows 1, 2, and 3 to be easiest to use.</p>
<p><strong>The SPAS system only fits models were the number of rows after pooling is less than or equal to the number of columns after pooling.</strong></p>
<div id="results-from-model-1-no-pooling." class="section level3">
<h3>Results from model 1 (no pooling).</h3>
<p>The likelihood is rather flat, so don’t be too concerned about messages from the optimization on failing to converge. As long as the likelihood values seem to be have stabilized and estimates are sensible (i.e. capture rates not 0 or 1; estimates of movement sensible results), the estimates should be fine.</p>
<p>The results of the model fit is a LARGE list. But the function <code>SPAS.print.model</code> produces a nice report</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">SPAS.print.model</span>(mod1)
<span class="co">#&gt; Model Name: No restrictions </span>
<span class="co">#&gt;    Date of Fit: 2019-01-03 21:19 </span>
<span class="co">#&gt;    Version of OPEN SPAS used : SPAS-R 2019-01-01 </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Raw data </span>
<span class="co">#&gt;       V1   V2   V3   V4  V5  V6  V7</span>
<span class="co">#&gt; [1,]   9   21    0    0   0   0 171</span>
<span class="co">#&gt; [2,]   0  101   22    1   0   0 763</span>
<span class="co">#&gt; [3,]   0    0  128   49   0   0 934</span>
<span class="co">#&gt; [4,]   0    0    0   48  12   0 434</span>
<span class="co">#&gt; [5,]   0    0    0    0   7   0  49</span>
<span class="co">#&gt; [6,]   0    0    0    0   0   0   4</span>
<span class="co">#&gt; [7,] 351 2736 3847 1818 543 191   0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Row pooling setup : 1 2 3 4 5 6 </span>
<span class="co">#&gt; Col pooling setup : 1 2 3 4 5 6 </span>
<span class="co">#&gt; Theta pooling     : FALSE </span>
<span class="co">#&gt; CJS pooling       : FALSE </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Raw data AFTER POOLING </span>
<span class="co">#&gt;       pool1 pool2 pool3 pool4 pool5 pool6  V7</span>
<span class="co">#&gt; pool1     9    21     0     0     0     0 171</span>
<span class="co">#&gt; pool2     0   101    22     1     0     0 763</span>
<span class="co">#&gt; pool3     0     0   128    49     0     0 934</span>
<span class="co">#&gt; pool4     0     0     0    48    12     0 434</span>
<span class="co">#&gt; pool5     0     0     0     0     7     0  49</span>
<span class="co">#&gt; pool6     0     0     0     0     0     0   4</span>
<span class="co">#&gt;         351  2736  3847  1818   543   191   0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Conditional   Log-Likelihood: 78115.94    ;  np: 48 ;  AICc: 156328.3 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Code/Message from optimization is:  2 Maximum function evals exceeded </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates</span>
<span class="co">#&gt;              pool1  pool2  pool3  pool4 pool5 pool6 psi cap.prob</span>
<span class="co">#&gt; pool1          8.9   21.1    0.0    0.0   0.0   0.0 171    0.025</span>
<span class="co">#&gt; pool2          0.0  101.2   21.8    1.0   0.0   0.0 763    0.050</span>
<span class="co">#&gt; pool3          0.0    0.0  126.5   50.5   0.0   0.0 934    0.035</span>
<span class="co">#&gt; pool4          0.0    0.0    0.0   48.5  11.5   0.0 434    0.103</span>
<span class="co">#&gt; pool5          0.0    0.0    0.0    0.0   4.9   2.1  49    0.011</span>
<span class="co">#&gt; pool6          0.0    0.0    0.0    0.0   0.0   0.0   4    0.013</span>
<span class="co">#&gt; est unmarked 351.1 2735.8 3848.7 1816.0 545.6 188.9   0       NA</span>
<span class="co">#&gt;              exp factor Pop Est</span>
<span class="co">#&gt; pool1              39.3    8096</span>
<span class="co">#&gt; pool2              18.9   17615</span>
<span class="co">#&gt; pool3              27.2   31303</span>
<span class="co">#&gt; pool4               8.7    4807</span>
<span class="co">#&gt; pool5              90.4    5121</span>
<span class="co">#&gt; pool6              77.2     313</span>
<span class="co">#&gt; est unmarked         NA   67257</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SE of above estimates</span>
<span class="co">#&gt;              pool1 pool2 pool3 pool4 pool5 pool6  psi cap.prob exp factor</span>
<span class="co">#&gt; pool1            3   4.6   0.0   0.0   0.0   0.1 13.1    0.008       13.4</span>
<span class="co">#&gt; pool2            0  10.0   4.6   1.0   0.0   0.1 27.6    0.010        3.8</span>
<span class="co">#&gt; pool3            0   0.0  11.2   7.1   0.0   0.1 30.6    0.003        2.6</span>
<span class="co">#&gt; pool4            0   0.0   0.0   6.9   3.3   0.0 20.8    0.053        5.0</span>
<span class="co">#&gt; pool5            0   0.0   0.0   0.0   1.9   0.8  7.0    0.004       35.5</span>
<span class="co">#&gt; pool6            0   0.0   0.0   0.0   0.0   0.1  2.0      NaN        NaN</span>
<span class="co">#&gt; est unmarked    NA    NA    NA    NA    NA    NA  0.0       NA         NA</span>
<span class="co">#&gt;              Pop Est</span>
<span class="co">#&gt; pool1           2689</span>
<span class="co">#&gt; pool2           3405</span>
<span class="co">#&gt; pool3           2939</span>
<span class="co">#&gt; pool4           2483</span>
<span class="co">#&gt; pool5           1988</span>
<span class="co">#&gt; pool6            NaN</span>
<span class="co">#&gt; est unmarked    2775</span></code></pre></div>
<p>The original data, the data after pooling, estimates and their standard errors are shown. Here the stratified-Petersen estimate of the total number of smolts passing the at the first sampling station is 67,257 with a standard error of 2,775.</p>
<p>Each entry in the output is available in fitted model object. You will need to explore the structure</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(mod1)
<span class="co">#&gt; [1] &quot;version&quot;      &quot;date&quot;         &quot;input&quot;        &quot;fit.setup&quot;   </span>
<span class="co">#&gt; [5] &quot;conditional&quot;  &quot;model.info&quot;   &quot;est.red.star&quot; &quot;est.star&quot;    </span>
<span class="co">#&gt; [9] &quot;real&quot;</span>
<span class="kw">names</span>(mod1<span class="op">$</span>real)
<span class="co">#&gt; [1] &quot;est.all&quot;   &quot;vcv.all&quot;   &quot;se.all&quot;    &quot;est.indiv&quot;</span>
<span class="kw">names</span>(mod1<span class="op">$</span>real<span class="op">$</span>est.indiv)
<span class="co">#&gt;  [1] &quot;theta&quot;          &quot;psi&quot;            &quot;cap&quot;            &quot;N&quot;             </span>
<span class="co">#&gt;  [5] &quot;N.stratum&quot;      &quot;theta.vcv&quot;      &quot;theta.se&quot;       &quot;cap.vcv&quot;       </span>
<span class="co">#&gt;  [9] &quot;cap.se&quot;         &quot;psi.vcv&quot;        &quot;psi.se&quot;         &quot;N.vcv&quot;         </span>
<span class="co">#&gt; [13] &quot;N.se&quot;           &quot;N.stratum.vcv&quot;  &quot;N.stratum.se&quot;   &quot;exp.factor&quot;    </span>
<span class="co">#&gt; [17] &quot;exp.factor.vcv&quot; &quot;exp.factor.se&quot;</span></code></pre></div>
<p>The <code>N</code> entries refer to the population size; the <code>N.stratum</code> entries refer to the individual stratum population sizes; the <code>cap</code> entries refer to the estimated probability of capture in each row stratum; the <code>exp.factor</code> entries refer to <code>(1-cap)/cap</code>, or the expansion factor for each row; the <code>psi</code> entries refer to the number of animals tagged but never seen again (the right most column in the input data); and the <code>theta</code> entires refer to the expected number of animals that were tagged in row stratum <span class="math inline">\(i\)</span> and recovered in column stratum <span class="math inline">\(j\)</span> (after pooling).</p>
</div>
<div id="pooling-some-rows-and-columns" class="section level3">
<h3>Pooling some rows and columns</h3>
<p>As noted by Darroch (1961), the stratified-Petersen will fail if the matrix of movements is close to singular. This often happens if two rows are proportional to each other. In this case, there is no unique MLE for the probability of capture in the two rows, and they should be pooled. A detailed discussion of pooling is found in Schwarz and Taylor (1998).</p>
<p>Let us now poolw the first two rows and the last two rows, but leave rows 3 and 4 alone. Similar, let us pool the last two columns.</p>
<p>The code is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod2 &lt;-<span class="st"> </span><span class="kw">SPAS.fit.model</span>(conne.data, <span class="dt">model.id=</span><span class="st">&quot;Pooling some rows&quot;</span>,
                       <span class="dt">row.pool.in=</span><span class="kw">c</span>(<span class="st">&quot;12&quot;</span>,<span class="st">&quot;12&quot;</span>,<span class="st">&quot;3&quot;</span>,<span class="st">&quot;4&quot;</span>,<span class="st">&quot;56&quot;</span>,<span class="st">&quot;56&quot;</span>),
                       <span class="dt">col.pool.in=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">56</span>,<span class="dv">56</span>))</code></pre></div>
<p>Notice how we specify the pooling for rows and columns and the choice of entries for the two corresponding vectors. I used character entries for the row pooling to ensure that the pooled matrix is sorted properly (see below); the numeric entries for the columns is ok as is.</p>
<p>The results of the model fit is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">SPAS.print.model</span>(mod2)
<span class="co">#&gt; Model Name: Pooling some rows </span>
<span class="co">#&gt;    Date of Fit: 2019-01-03 21:19 </span>
<span class="co">#&gt;    Version of OPEN SPAS used : SPAS-R 2019-01-01 </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Raw data </span>
<span class="co">#&gt;       V1   V2   V3   V4  V5  V6  V7</span>
<span class="co">#&gt; [1,]   9   21    0    0   0   0 171</span>
<span class="co">#&gt; [2,]   0  101   22    1   0   0 763</span>
<span class="co">#&gt; [3,]   0    0  128   49   0   0 934</span>
<span class="co">#&gt; [4,]   0    0    0   48  12   0 434</span>
<span class="co">#&gt; [5,]   0    0    0    0   7   0  49</span>
<span class="co">#&gt; [6,]   0    0    0    0   0   0   4</span>
<span class="co">#&gt; [7,] 351 2736 3847 1818 543 191   0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Row pooling setup : 12 12 3 4 56 56 </span>
<span class="co">#&gt; Col pooling setup : 1 2 3 4 56 56 </span>
<span class="co">#&gt; Theta pooling     : FALSE </span>
<span class="co">#&gt; CJS pooling       : FALSE </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Raw data AFTER POOLING </span>
<span class="co">#&gt;        pool1 pool2 pool3 pool4 pool56  V7</span>
<span class="co">#&gt; pool12     9   122    22     1      0 934</span>
<span class="co">#&gt; pool3      0     0   128    49      0 934</span>
<span class="co">#&gt; pool4      0     0     0    48     12 434</span>
<span class="co">#&gt; pool56     0     0     0     0      7  53</span>
<span class="co">#&gt;          351  2736  3847  1818    734   0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Conditional   Log-Likelihood: 79052.81    ;  np: 28 ;  AICc: 158161.7 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Code/Message from optimization is:  2 Maximum function evals exceeded </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates</span>
<span class="co">#&gt;              pool1  pool2  pool3  pool4 pool56 psi cap.prob exp factor</span>
<span class="co">#&gt; pool12        11.7  119.3   21.9    1.0    0.0 934    0.042       22.9</span>
<span class="co">#&gt; pool3          0.0    0.0  127.6   49.4    0.0 934    0.037       26.2</span>
<span class="co">#&gt; pool4          0.0    0.0    0.0   48.2   11.8 434    0.088       10.4</span>
<span class="co">#&gt; pool56         0.8    0.0    0.0    0.0    6.2  53    0.010       98.5</span>
<span class="co">#&gt; est unmarked 347.5 2738.6 3847.4 1817.5  735.0   0       NA         NA</span>
<span class="co">#&gt;              Pop Est</span>
<span class="co">#&gt; pool12         26048</span>
<span class="co">#&gt; pool3          30222</span>
<span class="co">#&gt; pool4           5610</span>
<span class="co">#&gt; pool56          5971</span>
<span class="co">#&gt; est unmarked   67855</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SE of above estimates</span>
<span class="co">#&gt;              pool1 pool2 pool3 pool4 pool56  psi cap.prob exp factor</span>
<span class="co">#&gt; pool12         4.2  11.2   4.7   1.0    0.1 30.6    0.004        2.2</span>
<span class="co">#&gt; pool3          0.1   0.1  11.3   7.0    0.1 30.6    0.003        2.6</span>
<span class="co">#&gt; pool4          0.1   0.1   0.1   6.9    3.4 20.8    0.039        5.0</span>
<span class="co">#&gt; pool56         1.0   0.1   0.1   0.1    2.5  7.3    0.004       42.1</span>
<span class="co">#&gt; est unmarked    NA    NA    NA    NA     NA  0.0       NA         NA</span>
<span class="co">#&gt;              Pop Est</span>
<span class="co">#&gt; pool12          2403</span>
<span class="co">#&gt; pool3           2836</span>
<span class="co">#&gt; pool4           2458</span>
<span class="co">#&gt; pool56          2524</span>
<span class="co">#&gt; est unmarked    3588</span></code></pre></div>
<p>Here the stratified-Petersen estimate of the total number of smolts passing the at the first sampling station is 67,855 with a standard error of 3,588. which is a slight reduction from the unpooled estimates.</p>
</div>
</div>
<div id="pooling-to-a-single-row-and-complete-pooling" class="section level2">
<h2>Pooling to a single row and complete pooling</h2>
<p>You can pool to a single row (and multiple columns) or a single row and single column (which is equivalent to the pooled Petersen estimator). The code and output follow:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod3 &lt;-<span class="st"> </span><span class="kw">SPAS.fit.model</span>(conne.data, <span class="dt">model.id=</span><span class="st">&quot;A single row&quot;</span>,
                       <span class="dt">row.pool.in=</span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(conne.data)<span class="op">-</span><span class="dv">1</span>),
                       <span class="dt">col.pool.in=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">56</span>,<span class="dv">56</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">SPAS.print.model</span>(mod3)
<span class="co">#&gt; Model Name: A single row </span>
<span class="co">#&gt;    Date of Fit: 2019-01-03 21:19 </span>
<span class="co">#&gt;    Version of OPEN SPAS used : SPAS-R 2019-01-01 </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Raw data </span>
<span class="co">#&gt;       V1   V2   V3   V4  V5  V6  V7</span>
<span class="co">#&gt; [1,]   9   21    0    0   0   0 171</span>
<span class="co">#&gt; [2,]   0  101   22    1   0   0 763</span>
<span class="co">#&gt; [3,]   0    0  128   49   0   0 934</span>
<span class="co">#&gt; [4,]   0    0    0   48  12   0 434</span>
<span class="co">#&gt; [5,]   0    0    0    0   7   0  49</span>
<span class="co">#&gt; [6,]   0    0    0    0   0   0   4</span>
<span class="co">#&gt; [7,] 351 2736 3847 1818 543 191   0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Row pooling setup : 1 1 1 1 1 1 </span>
<span class="co">#&gt; Col pooling setup : 1 2 3 4 56 56 </span>
<span class="co">#&gt; Theta pooling     : FALSE </span>
<span class="co">#&gt; CJS pooling       : FALSE </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Raw data AFTER POOLING </span>
<span class="co">#&gt;   pool1 pool2 pool3 pool4 pool56   V7</span>
<span class="co">#&gt; 1     9   122   150    98     19 2355</span>
<span class="co">#&gt;     351  2736  3847  1818    734    0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Conditional   Log-Likelihood: 81857.54    ;  np: 7 ;  AICc: 163729.1 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Code/Message from optimization is:  0 Successful convergence </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates</span>
<span class="co">#&gt;              pool1  pool2  pool3  pool4 pool56  psi cap.prob exp factor</span>
<span class="co">#&gt; 1             14.5  115.1  160.9   77.2   30.3 2355     0.04       23.8</span>
<span class="co">#&gt; est unmarked 345.5 2742.9 3836.1 1838.8  722.7    0       NA         NA</span>
<span class="co">#&gt;              Pop Est</span>
<span class="co">#&gt; 1              68369</span>
<span class="co">#&gt; est unmarked   68369</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SE of above estimates</span>
<span class="co">#&gt;              pool1 pool2 pool3 pool4 pool56  psi cap.prob exp factor</span>
<span class="co">#&gt; 1                1     6   8.3   4.2    1.9 48.5    0.002        1.2</span>
<span class="co">#&gt; est unmarked    NA    NA    NA    NA     NA  0.0       NA         NA</span>
<span class="co">#&gt;              Pop Est</span>
<span class="co">#&gt; 1               3105</span>
<span class="co">#&gt; est unmarked    3105</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod4 &lt;-<span class="st"> </span><span class="kw">SPAS.fit.model</span>(conne.data, <span class="dt">model.id=</span><span class="st">&quot;Pooled Peteren&quot;</span>,
                       <span class="dt">row.pool.in=</span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(conne.data)<span class="op">-</span><span class="dv">1</span>),
                       <span class="dt">col.pool.in=</span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">ncol</span>(conne.data)<span class="op">-</span><span class="dv">1</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">SPAS.print.model</span>(mod4)
<span class="co">#&gt; Model Name: Pooled Peteren </span>
<span class="co">#&gt;    Date of Fit: 2019-01-03 21:19 </span>
<span class="co">#&gt;    Version of OPEN SPAS used : SPAS-R 2019-01-01 </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Raw data </span>
<span class="co">#&gt;       V1   V2   V3   V4  V5  V6  V7</span>
<span class="co">#&gt; [1,]   9   21    0    0   0   0 171</span>
<span class="co">#&gt; [2,]   0  101   22    1   0   0 763</span>
<span class="co">#&gt; [3,]   0    0  128   49   0   0 934</span>
<span class="co">#&gt; [4,]   0    0    0   48  12   0 434</span>
<span class="co">#&gt; [5,]   0    0    0    0   7   0  49</span>
<span class="co">#&gt; [6,]   0    0    0    0   0   0   4</span>
<span class="co">#&gt; [7,] 351 2736 3847 1818 543 191   0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Row pooling setup : 1 1 1 1 1 1 </span>
<span class="co">#&gt; Col pooling setup : 1 1 1 1 1 1 </span>
<span class="co">#&gt; Theta pooling     : FALSE </span>
<span class="co">#&gt; CJS pooling       : FALSE </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Raw data AFTER POOLING </span>
<span class="co">#&gt;      1   V7</span>
<span class="co">#&gt; 1  398 2355</span>
<span class="co">#&gt;   9486    0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Conditional   Log-Likelihood: 95297.26    ;  np: 3 ;  AICc: 190600.5 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Code/Message from optimization is:  0 Successful convergence </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimates</span>
<span class="co">#&gt;                 1  psi cap.prob exp factor Pop Est</span>
<span class="co">#&gt; 1             398 2355     0.04       23.8   68368</span>
<span class="co">#&gt; est unmarked 9486    0       NA         NA   68368</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; SE of above estimates</span>
<span class="co">#&gt;                 1  psi cap.prob exp factor Pop Est</span>
<span class="co">#&gt; 1            19.9 48.5    0.002        1.2    3105</span>
<span class="co">#&gt; est unmarked   NA  0.0       NA         NA    3105</span></code></pre></div>
<p>Both models have an estimated abundance of 68,369 with a standard error of 3,105. which is a slight reduction from the unpooled estimates.</p>
</div>
<div id="comparing-different-pooling" class="section level2">
<h2>Comparing different pooling</h2>
<p><strong>Unfortunately, because pooling actually changes the data (internally), it is not possible to do likelihood ratio testing or to use AICc to compare different poolings.</strong> Methods to compare different poolings is under active investigation.</p>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>Darroch, J. N. (1961). The two-sample capture-recapture census when tagging and sampling are stratified. Biometrika, 48, 241–260. <a href="https://www.jstor.org/stable/2332748" class="uri">https://www.jstor.org/stable/2332748</a></p>
<p>Plante, N., L.-P Rivest, and G. Tremblay. (1988). Stratified Capture-Recapture Estimation of the Size of a Closed Population. Biometrics 54, 47-60. <a href="https://www.jstor.org/stable/2533994" class="uri">https://www.jstor.org/stable/2533994</a></p>
<p>Schwarz, C. J., &amp; Taylor, C. G. (1998). The use of the stratified-Petersen estimator in fisheries management with an illustration of estimating the number of pink salmon (Oncorhynchus gorbuscha) that return to spawn in the Fraser River. Canadian Journal of Fisheries and Aquatic Sciences, 55, 281–296. <a href="https://doi.org/10.1139/f97-238" class="uri">https://doi.org/10.1139/f97-238</a></p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
